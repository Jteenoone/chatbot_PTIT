<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <link
      rel="apple-touch-icon"
      sizes="57x57"
      href="{{ url_for('static', filename='ico/apple-icon-57x57.png') }}"
    />
    <link
      rel="apple-touch-icon"
      sizes="60x60"
      href="{{ url_for('static', filename='ico/apple-icon-60x60.png') }}"
    />
    <link
      rel="apple-touch-icon"
      sizes="72x72"
      href="{{ url_for('static', filename='ico/apple-icon-72x72.png') }}"
    />
    <link
      rel="apple-touch-icon"
      sizes="76x76"
      href="{{ url_for('static', filename='ico/apple-icon-76x76.png') }}"
    />
    <link
      rel="apple-touch-icon"
      sizes="114x114"
      href="{{ url_for('static', filename='ico/apple-icon-114x114.png') }}"
    />
    <link
      rel="apple-touch-icon"
      sizes="120x120"
      href="{{ url_for('static', filename='ico/apple-icon-120x120.png') }}"
    />
    <link
      rel="apple-touch-icon"
      sizes="144x144"
      href="{{ url_for('static', filename='ico/apple-icon-144x144.png') }}"
    />
    <link
      rel="apple-touch-icon"
      sizes="152x152"
      href="{{ url_for('static', filename='ico/apple-icon-152x152.png') }}"
    />
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="{{ url_for('static', filename='ico/apple-icon-180x180.png') }}"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="192x192"
      href="{{ url_for('static', filename='ico/android-icon-192x192.png') }}"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="{{ url_for('static', filename='ico/favicon-32x32.png') }}"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="96x96"
      href="{{ url_for('static', filename='ico/favicon-96x96.png') }}"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="{{ url_for('static', filename='ico/favicon-16x16.png') }}"
    />
    <link
      rel="manifest"
      href="{{ url_for('static', filename='ico/manifest.json') }}"
    />
    <meta name="msapplication-TileColor" content="#ffffff" />
    <meta
      name="msapplication-TileImage"
      content="{{ url_for('static', filename='ico/ms-icon-144x144.png') }}"
    />
    <meta name="theme-color" content="#ffffff" />
    <title>Trang Qu·∫£n tr·ªã - Tr·ª£ l√Ω ·∫¢o PTIT</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>

  <body class="bg-gray-50 text-gray-800">
    <header class="bg-red-600 text-white py-4 mb-6 shadow">
      <div class="max-w-5xl mx-auto px-4 flex justify-between items-center">
        <h1 class="text-xl font-semibold">
          üîß Qu·∫£n tr·ªã h·ªá th·ªëng - Tr·ª£ l√Ω ·∫¢o PTIT
        </h1>
        <a href="/" class="text-sm underline hover:text-gray-200"
          >‚Üê Quay l·∫°i Chatbot</a
        >
      </div>
    </header>

    <main class="max-w-5xl mx-auto px-4">
      {% if not auth %}
      <section
        class="bg-white border border-gray-200 rounded-2xl shadow p-6 max-w-md mx-auto"
      >
        <h2 class="text-lg font-semibold text-gray-700 mb-3">
          ƒêƒÉng nh·∫≠p qu·∫£n tr·ªã
        </h2>
        {% if error %}
        <p class="text-red-600 text-sm mb-3">{{ error }}</p>
        {% endif %}
        <form method="POST" action="/admin" class="space-y-4">
          <div>
            <label class="block text-sm font-medium">M·∫≠t kh·∫©u qu·∫£n tr·ªã:</label>
            <input
              type="password"
              name="password"
              required
              class="w-full border border-gray-300 rounded-lg px-3 py-2 mt-1 focus:ring-2 focus:ring-red-600"
            />
          </div>
          <button
            type="submit"
            class="w-full bg-red-600 hover:bg-red-700 text-white py-2 rounded-lg font-medium"
          >
            ƒêƒÉng nh·∫≠p
          </button>
        </form>
      </section>

      {% else %}
      <!-- N·ªòI DUNG QU·∫¢N TR·ªä -->
      {% if message %}
      <div class="bg-green-100 text-green-700 px-4 py-2 mb-4 rounded-lg">
        {{ message }}
      </div>
      {% endif %} {% if error %}
      <div class="bg-red-100 text-red-700 px-4 py-2 mb-4 rounded-lg">
        {{ error }}
      </div>
      {% endif %}

      <div class="grid md:grid-cols-2 gap-6">
        <!-- Upload tri th·ª©c -->
        <section class="bg-white border border-gray-200 rounded-2xl shadow p-6">
          <h2 class="text-lg font-semibold text-gray-700 mb-3">
            üìÑ C·∫≠p nh·∫≠t tri th·ª©c
          </h2>
          <form
            method="POST"
            action="/upload"
            enctype="multipart/form-data"
            class="space-y-3"
          >
            <div>
              <label class="block text-sm font-medium mb-1"
                >Ch·ªçn file (.pdf, .txt, .docx...)</label
              >
              <input
                type="file"
                name="file"
                required
                class="block w-full border border-gray-300 rounded-lg px-3 py-2"
              />
            </div>
            <button
              type="submit"
              class="w-full bg-blue-600 hover:bg-blue-700 text-white py-2 rounded-lg font-medium"
            >
              üì§ T·∫£i l√™n v√† c·∫≠p nh·∫≠t KB
            </button>
          </form>
        </section>

        <!-- FAQ -->
        <section class="bg-white border border-gray-200 rounded-2xl shadow p-6">
          <h2 class="text-lg font-semibold text-gray-700 mb-3">
            üí¨ Qu·∫£n l√Ω FAQ
          </h2>
          <form method="POST" action="/rebuild-faq" class="space-y-3">
            <p class="text-sm text-gray-600">
              Sau khi ch·ªânh s·ª≠a file <code>local_faq.json</code>, h√£y rebuild
              l·∫°i FAQ.
            </p>
            <button
              type="submit"
              class="w-full bg-yellow-500 hover:bg-yellow-600 text-white py-2 rounded-lg font-medium"
            >
              üîÅ Rebuild FAQ
            </button>
          </form>
        </section>

        <!-- Reset -->
        <section
          class="bg-white border border-gray-200 rounded-2xl shadow p-6 md:col-span-2"
        >
          <h2 class="text-lg font-semibold text-gray-700 mb-3">
            üßπ L√†m m·ªõi tri th·ª©c
          </h2>
          <form method="POST" action="/reset-knowledge" class="space-y-3">
            <p class="text-sm text-gray-600">
              X√≥a to√†n b·ªô d·ªØ li·ªáu <code>ChromaDB</code> v√† x√¢y l·∫°i t·ª´
              <code>old_docs</code>.
            </p>
            <button
              type="submit"
              class="w-full bg-red-600 hover:bg-red-700 text-white py-2 rounded-lg font-medium"
            >
              ‚ö†Ô∏è Reset Knowledge Base
            </button>
          </form>
        </section>

        <!-- Danh s√°ch file -->
        <section
          class="bg-white border border-gray-200 rounded-2xl shadow p-6 md:col-span-2"
        >
          <h2 class="text-lg font-semibold text-gray-700 mb-3">
            üìö Danh s√°ch t√†i li·ªáu hi·ªán c√≥
          </h2>
          {% if knowledge_files %}
          <ul class="list-disc pl-6 text-sm text-gray-700">
            {% for f in knowledge_files %}
            <li>{{ f }}</li>
            {% endfor %}
          </ul>
          {% else %}
          <p class="text-gray-500 text-sm italic">Ch∆∞a c√≥ t√†i li·ªáu n√†o.</p>
          {% endif %}
        </section>
      </div>
      {% endif %}
    </main>

    <footer
      class="text-center text-gray-500 text-sm py-6 mt-10 border-t border-gray-200"
    >
      ¬© 2025 PTIT Virtual Assistant ‚Äì Flask + LangChain
    </footer>
  </body>
</html>
